<!DOCTYPE html>
<html>
<head>
  <title>OPD Voided Transactions</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f4f8fb;
      margin: 0;
      color: #222;
      font-size: 15px;
    }
    /* SIDEBAR & NAV ONLY */
    .sidebar {
      width: 250px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      padding-top: 10px;
      padding: 12px;
      position: fixed;
      top: 20px;
      left: 20px;
      bottom: 20px;
      overflow-y: auto;
      border-left: 4px solid #0891b2;
    }
    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 18px;
      font-size: 15px;
      font-weight: 500;
      color: #333;
      border-radius: 10px;
      margin: 8px 10px;
      background: #fff;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      transition: all 0.25s ease;
      position: relative;
      text-decoration: none;
    }
    .nav-link:hover,
    .nav-link.active {
      background: #e6f7fa;
      color: #0891b2;
      border-color: #b3e5ef;
      box-shadow: 0 3px 8px rgba(8,145,178,0.1);
    }
    .nav-link:hover::before,
    .nav-link.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: #0891b2; /* OsLAM title color */
      border-radius: 4px 0 0 4px;
      box-shadow: 0 0 0 1px #0891b2;
    }
  </style>
</head>
<body>
   <!-- FLOATING SIDEBAR -->
  <aside class="sidebar">
    <div style="display:flex;align-items:center;gap:12px;padding:24px 20px 12px 20px;">
      <img src="/logo.png" style="width:44px;height:44px;border-radius:8px;object-fit:contain;">
      <div>
        <div style="font-size:20px;font-weight:700;color:#0891b2;">OsLAM</div>
        <div style="font-size:13px;color:#666;">Outpatient</div>
      </div>
    </div>
     <nav style="margin-top:10px;">
      <ul style="list-style:none;padding:0;margin:0;">
        <li><a href="/opddashboard" class="nav-link"><i class="bi bi-grid"></i> Dashboard</a></li>
        <li><a href="/opd" class="nav-link"><i class="bi bi-person-lines-fill"></i> Outpatient</a></li>
        <li><a href="/opd/voided" class="nav-link"><i class="bi bi-x-circle"></i> Void Transaction</a></li>
        <li><a href="/opd/deleted-diagnoses" class="nav-link"><i class="bi bi-trash"></i> Deleted Diagnose</a></li>
      </ul>
    </nav>
  </aside>

  <div style="margin-left: 260px; background:#f5f7fa; min-height:100vh;">
    <div class="container" style="max-width:1100px; margin:40px auto; background:#fff; border-radius:8px; box-shadow:0 2px 12px rgba(0,0,0,0.08); padding:32px;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
        <h2 style="margin:0;">OPD Voided Transactions</h2>
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="position: relative;">
            <button onclick="toggleOpdVoidViewMenu()" style="padding: 5px 10px; cursor: pointer; display: flex; align-items: center; gap: 5px; background: white; border: 1px solid #ccc; border-radius: 4px;">
              <i class="bi bi-eye"></i> View
            </button>
            <div id="opdVoidViewMenu" style="display: none; position: absolute; top: 100%; right: 0; background: white; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); min-width: 150px; z-index: 1000; margin-top: 2px;">
              <div style="padding: 8px 12px; font-weight: 600; border-bottom: 1px solid #eee;">Show Columns</div>
              <label style="display: block; padding: 6px 12px; cursor: pointer; user-select: none;">
                <input type="checkbox" checked onchange="toggleOpdVoidColumn('col-hrn', this)"> HRN
              </label>
              <label style="display: block; padding: 6px 12px; cursor: pointer; user-select: none;">
                <input type="checkbox" checked onchange="toggleOpdVoidColumn('col-name', this)"> Full Name
              </label>
              <label style="display: block; padding: 6px 12px; cursor: pointer; user-select: none;">
                <input type="checkbox" checked onchange="toggleOpdVoidColumn('col-birthday', this)"> Birthday
              </label>
              <label style="display: block; padding: 6px 12px; cursor: pointer; user-select: none;">
                <input type="checkbox" checked onchange="toggleOpdVoidColumn('col-voidedby', this)"> Voided By
              </label>
              <label style="display: block; padding: 6px 12px; cursor: pointer; user-select: none;">
                <input type="checkbox" checked onchange="toggleOpdVoidColumn('col-voiddate', this)"> Void Date
              </label>
              <label style="display: block; padding: 6px 12px; cursor: pointer; user-select: none;">
                <input type="checkbox" checked onchange="toggleOpdVoidColumn('col-action', this)"> Action
              </label>
            </div>
          </div>
          <input type="text" id="opdVoidSearch" placeholder="Search by HRN or Name" style="padding: 5px 10px; width: 200px; border: 1px solid #ccc; border-radius: 4px;">
          <select id="opdVoidRowsPerPage" style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 4px;">
            <option value="10">10 rows</option>
            <option value="25">25 rows</option>
            <option value="50">50 rows</option>
            <option value="100">100 rows</option>
            <option value="all">all</option>
          </select>
        </div>
      </div>
      <!-- ...existing table and content... -->

    <% if (patients.length === 0) { %>
      <p>No voided transactions found.</p>
    <% } else { %>
      <table id="opdVoidTable">
        <thead>
          <tr>
            <th class="col-hrn">HRN</th>
            <th class="col-name">Full Name</th>
            <th class="col-birthday">Birthday</th>
            <th class="col-voidedby">Voided By</th>
            <th class="col-voiddate">Void Date</th>
            <th class="col-action">Action</th>
          </tr>
        </thead>
        <tbody>
          <% patients.forEach(patient => { %>
            <tr>
              <td class="col-hrn"><%= patient.hrn %></td>
              <td class="col-name"><%= patient.fullName %></td>
              <td class="col-birthday"><%= patient.birthday ? new Date(patient.birthday).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A' %></td>
              <td class="col-voidedby"><%= patient.voidedBy || 'N/A' %></td>
              <td class="col-voiddate"><%= new Date(patient.voidedAt).toLocaleString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></td>
              <td class="col-action">
                <a href="/opd/voided/<%= patient.hrn %>" style="color: #0b5ed7; text-decoration: underline;">View</a>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
      <div id="opdVoidPager" style="display:flex; align-items:center; justify-content:flex-end; gap:10px; margin-top:10px; font-size:13px; color:#666;">
        <div id="opdVoidPageInfo"></div>
        <button id="opdVoidPrevBtn" style="padding: 5px 15px; cursor: pointer; border: 1px solid #ccc; background: white; border-radius: 4px;">&laquo;</button>
        <button id="opdVoidNextBtn" style="padding: 5px 15px; cursor: pointer; border: 1px solid #ccc; background: white; border-radius: 4px;">&raquo;</button>
      </div>
    <% } %>
  </div>

  <script>
    function toggleOpdVoidViewMenu() {
      const menu = document.getElementById('opdVoidViewMenu');
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }

    function toggleOpdVoidColumn(colClass, checkbox) {
      const cells = document.querySelectorAll('.' + colClass);
      cells.forEach(cell => {
        cell.style.display = checkbox.checked ? '' : 'none';
      });
    }

    window.addEventListener('click', function(e) {
      const menu = document.getElementById('opdVoidViewMenu');
      const btn = e.target.closest('button');
      if (!menu.contains(e.target) && (!btn || btn.onclick !== toggleOpdVoidViewMenu)) {
        menu.style.display = 'none';
      }
    });

    (function() {
      const table = document.getElementById('opdVoidTable');
      if (!table) return;

      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      const searchInput = document.getElementById('opdVoidSearch');
      const rowsPerPageSelect = document.getElementById('opdVoidRowsPerPage');
      const pageInfo = document.getElementById('opdVoidPageInfo');
      const prevBtn = document.getElementById('opdVoidPrevBtn');
      const nextBtn = document.getElementById('opdVoidNextBtn');

      let state = { search: '', perPage: 10, page: 1 };

      function filterRows() {
        const term = state.search.toLowerCase();
        return rows.filter(row => {
          if (!term) return true;
          const hrn = row.children[0]?.textContent.toLowerCase() || '';
          const name = row.children[1]?.textContent.toLowerCase() || '';
          return hrn.includes(term) || name.includes(term);
        });
      }

      function render() {
        const filtered = filterRows();
        const perPage = state.perPage === Infinity ? filtered.length : state.perPage;
        const totalPages = Math.ceil(filtered.length / perPage) || 1;
        if (state.page > totalPages) state.page = totalPages;

        rows.forEach(r => r.style.display = 'none');
        const start = (state.page - 1) * perPage;
        const end = start + perPage;
        filtered.slice(start, end).forEach(r => r.style.display = '');

        pageInfo.textContent = `Page ${state.page} of ${totalPages}`;
        prevBtn.disabled = state.page <= 1;
        nextBtn.disabled = state.page >= totalPages;
      }

      searchInput.addEventListener('input', e => {
        state.search = e.target.value;
        state.page = 1;
        render();
      });

      rowsPerPageSelect.addEventListener('change', e => {
        state.perPage = e.target.value === 'all' ? Infinity : parseInt(e.target.value, 10);
        state.page = 1;
        render();
      });

      prevBtn.addEventListener('click', () => {
        if (state.page > 1) { state.page--; render(); }
      });

      nextBtn.addEventListener('click', () => {
        const filtered = filterRows();
        const perPage = state.perPage === Infinity ? filtered.length : state.perPage;
        const totalPages = Math.ceil(filtered.length / perPage) || 1;
        if (state.page < totalPages) { state.page++; render(); }
      });

      render();
    })();
  </script>
</body>
</html>
